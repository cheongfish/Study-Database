# 데이터베이스 내부 원리

## 1. 데이터베이스의 기본 개념
- **테이블**: 행(row)과 열(column)로 구성된 데이터 저장 구조.
- **행 ID (Row ID)**:
  - 행의 고유 식별자.
  - Postgres에서는 "튜플 ID(Tuple ID)"라고 불림.
  - MySQL에서는 보통 기본 키를 사용해 유사한 방식으로 관리.
- **페이지(Page)**:
  - 고정 크기의 메모리 블록(예: Postgres는 8KB, MySQL은 16KB).
  - 페이지는 데이터를 저장하고 디스크에서 읽히는 최소 단위.
  - 한 페이지에는 여러 개의 행이 포함될 수 있음.

---

## 2. 데이터 저장 및 IO 동작
- **저장 방식**:
  - 테이블 데이터는 페이지 단위로 저장됨.
  - 디스크의 데이터는 행이나 바이트 단위로 읽히지 않고 페이지 단위로 읽힘.
- **IO (Input/Output)**:
  - 디스크에서 데이터를 읽는 작업.
  - IO 비용을 줄이는 것이 데이터베이스 성능 최적화의 핵심.
  - Postgres는 운영체제의 캐시를 활용해 IO를 줄이려고 함.

---

## 3. 힙(Heap)
- **힙의 정의**:
  - 테이블 데이터를 저장하는 페이지들의 집합.
  - 모든 테이블 정보가 힙에 저장됨.
- **힙 탐색 비용**:
  - 원하는 데이터를 찾기 위해 모든 페이지를 탐색해야 할 수 있음.
  - 따라서 힙 탐색만으로는 비효율적이며, 인덱스가 필요함.

---

## 4. 인덱스(Index)
- **인덱스의 역할**:
  - 힙 탐색을 최적화하기 위해 사용.
  - 특정 행이 저장된 페이지를 빠르게 찾을 수 있음.
- **구조**:
  - 힙과 별개의 데이터 구조로 저장.
  - 행 ID 및 페이지 포인터를 포함.
  - B-트리와 같은 데이터 구조를 사용해 빠른 검색 지원.
- **비용**:
  - 인덱스를 읽는 것도 IO 작업이므로 비용이 발생함.
  - 인덱스가 메모리에 적합할수록 성능이 좋아짐.

---

## 5. 클러스터 인덱스와 보조 인덱스
- **클러스터 인덱스**:
  - 테이블이 특정 인덱스 기준으로 물리적으로 정렬된 경우.
  - MySQL의 기본 키는 클러스터 인덱스로 취급.
  - Postgres는 클러스터 인덱스를 사용하지 않고 보조 인덱스를 사용.
- **보조 인덱스**:
  - 힙의 행 ID를 참조하며, 테이블 데이터를 정렬하지 않음.

---

## 6. 쿼리와 성능 최적화
- **쿼리 실행 방식**:
  - 인덱스가 없는 경우 힙의 모든 페이지를 탐색해야 함.
  - 인덱스가 있는 경우, 특정 페이지로 바로 접근 가능.
- **효율적인 IO**:
  - IO를 줄이고 필요한 페이지만 읽어야 성능이 향상됨.
  - `SELECT *`는 모든 열을 읽어야 하므로 비용이 높음.
  - 특정 열만 읽는 것이 더 효율적이나, 행 저장소에서는 모든 페이지 접근이 필요.

---

## 7. 기타 데이터베이스 구성 요소
- **UUID와 성능**:
  - 무작위 UUID는 데이터 정렬을 방해하여 클러스터 인덱스 성능을 저하시킴.
- **Postgres와 MySQL의 차이**:
  - Postgres는 보조 인덱스를 사용하며, 기본 키도 보조 인덱스로 관리.
  - MySQL은 항상 클러스터 인덱스를 사용.

---

## 8. 요약
- 테이블, 행 ID, 페이지, 힙, 인덱스의 개념을 이해하는 것이 중요.
- IO 동작을 최소화하고 인덱스를 적절히 활용해 데이터베이스 성능을 최적화.
- 데이터베이스 구조와 구성 요소에 따라 성능이 크게 달라질 수 있음.
