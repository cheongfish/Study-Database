# 기본 키와 보조 키에 대한 이해

## 기본 키란 무엇인가요?
기본 키란 테이블 내에서 각 행을 고유하게 식별하기 위해 사용되는 중요한 데이터베이스 개념임. 기본 키는 단순히 고유하다는 것 이상의 의미를 가지고 있음. 기본 키를 통해 데이터베이스는 테이블을 구성하고 쿼리를 최적화하는 데 필요한 암묵적인 정보를 제공함.

### 기본 키와 클러스터링
- **힙의 개념**: 테이블의 행은 보통 디스크의 특정 영역(힙)에 저장되며, 순서가 강제되지 않음. 따라서 데이터가 삽입되는 순서대로 저장됨.
- **기본 키의 추가**: 기본 키를 설정하면 테이블에 **클러스터링**이 발생함. 클러스터링은 데이터를 기본 키를 중심으로 정렬하며, 이는 쿼리 성능을 크게 향상시킴.
- **클러스터링의 장점**:
  - 범위 쿼리가 빠르게 수행됨.
  - 데이터를 한 번의 I/O로 읽을 수 있음.

### 기본 키의 데이터 삽입 방식
기본 키는 데이터를 정렬하여 테이블을 구성함. 예를 들어:
- 값 1, 8, 2를 순서대로 삽입하면 값 2는 값 1 뒤에, 값 8을 앞으로 밀어내며 위치하게 됨.
- 데이터베이스는 페이지를 지능적으로 관리하며, 삽입 공간을 미리 확보해둠.

### 데이터베이스 별 기본 키 사용 방식
- **MySQL**: 기본적으로 기본 키를 기반으로 작동하며, 클러스터형 인덱스를 필수로 사용함.
- **Oracle**: **IOT(인덱스 조직화된 테이블)**을 선택적으로 사용할 수 있음.
- **SQL Server**: 클러스터형 인덱스와 비슷한 방식으로 테이블을 구성할 수 있음.

## 보조 키란 무엇인가요?
보조 키(또는 보조 인덱스)는 기본 키와 다르게 테이블 자체를 정렬하지 않음. 대신 테이블 외부에 별도의 구조를 만들어 데이터를 효율적으로 검색할 수 있도록 도움을 줌.

### 보조 키의 특징
- **테이블 상태**: 보조 키가 적용된 테이블은 기본적으로 무작위로 데이터가 정렬되어 있음.
- **별도 구조**: 보조 키는 데이터베이스 외부에 별도의 **B-트리** 또는 비슷한 구조로 저장됨.
- **검색 방식**:
  - 보조 키를 통해 데이터의 위치(행 ID 등)를 찾음.
  - 원하는 데이터를 검색한 후 테이블(힙)로 이동해 실제 데이터를 가져옴.

### 보조 키의 단점
- **추가적인 이동 비용**: 데이터를 검색할 때 보조 키를 통해 위치를 찾고 다시 힙으로 이동해야 하므로 추가 비용이 발생함.
- **Postgres에서의 특징**: Postgres의 모든 인덱스는 보조 인덱스로 작동하며, 기본적으로 클러스터형 인덱스를 지원하지 않음.

## 클러스터형 인덱스와 보조 인덱스 비교
| 특징             | 클러스터형 인덱스                  | 보조 인덱스                     |
|------------------|----------------------------------|--------------------------------|
| 테이블 구성 방식   | 기본 키를 기준으로 정렬               | 외부 구조를 통해 데이터 검색          |
| 쿼리 성능         | 범위 쿼리에 최적화됨                | 검색 시 추가 I/O 발생            |
| 데이터 정렬       | 테이블 자체가 정렬됨                | 테이블은 무작위로 정렬됨            |
| 사용 예시         | MySQL, Oracle (IOT) 등 사용 가능 | Postgres는 보조 인덱스만 사용        |

## 결론
기본 키와 보조 키는 데이터베이스 성능 최적화에 중요한 역할을 함. 기본 키는 테이블을 정렬하여 빠른 검색을 지원하며, 보조 키는 별도의 구조를 통해 추가적인 검색 유연성을 제공함. 사용 사례에 따라 적절히 선택하여 데이터베이스 성능을 극대화하는 것이 중요함.