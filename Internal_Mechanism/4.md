# 데이터베이스 페이지

* 데이터베이스는 고정 크기의 **페이지**를 사용해 데이터를 저장함
*  테이블, 컬렉션, 행, 열, 인덱스, 시퀀스, 문서 등 모든 데이터는 결국 한 페이지에 바이트 형태로 저장됨
* 이러한 구조는 저장 엔진을 데이터 형식과 API를 관리하는 데이터베이스 프론트엔드와 분리하며, 데이터를 읽고 쓰거나 캐시하기 용이함함

---

## 1. 페이지 풀

### 데이터 읽기와 쓰기
* 데이터베이스는 행을 읽기 위해 해당 행이 속한 **페이지**를 확인하고, 페이지가 디스크에서 어떤 위치에 저장되어 있는지 식별함
* 데이터베이스는 OS에 요청해 특정 파일의 페이지를 메모리에 로드하며, OS는 파일 시스템 캐시를 확인해 데이터를 제공하거나 필요한 경우 디스크 읽기를 수행함함

### 버퍼 풀
* 데이터베이스는 일정 크기의 **메모리 풀**(버퍼 풀)을 할당하며, 읽은 페이지는 버퍼 풀에 저장함
* 버퍼 풀에 있는 페이지는 동일한 페이지의 다른 행도 접근할 수 있도록 하며, 이는 특히 **인덱스 범위 스캔**과 같은 작업에 효과적임

### 쓰기 작업
데이터를 업데이트할 때, 데이터베이스는 페이지를 버퍼 풀로 가져와 메모리에서 수정한 후, 변경 사항을 WAL(Write-Ahead Logging)로 디스크에 기록하며, 페이지는 최종적으로 디스크에 플러시됩니다.  
이로 인해 쓰기 작업의 효율성을 높일 수 있으며, 삭제와 삽입 작업도 유사한 방식으로 동작합니다.

---

## 2. 페이지 내용

### 저장 방식
- **Row-Store 데이터베이스**: 행과 속성을 차례로 기록하며 OLTP 워크로드에 적합.  
- **Column-Store 데이터베이스**: 열 단위로 저장하며 OLAP 작업에 적합.  
- **문서형 데이터베이스**: 문서를 압축해 행 저장소 방식으로 기록함.  
- **그래프 데이터베이스**: 그래프 탐색 연결성을 저장해 효율적 읽기/쓰기가 가능하도록 설계함.

### 효율적 데이터 모델링
작업 효율성을 위해 페이지에 데이터를 효과적으로 패킹하며, 너무 많은 페이지를 읽어야 한다면 데이터 모델링을 재검토해야 함.  

---

## 3. 소형 페이지 vs 대형 페이지

### 소형 페이지
소형 페이지는 읽기와 쓰기 속도가 빠르지만, 페이지 헤더 메타데이터 오버헤드가 증가할 수 있음.  

### 대형 페이지
대형 페이지는 메타데이터 오버헤드 감소와 페이지 분할 최소화 효과가 있지만 읽기/쓰기 비용이 증가할 수 있음.  

### 기본 페이지 크기
- PostgreSQL: 8KB  
- MySQL InnoDB: 16KB  
- MongoDB WiredTiger: 32KB  
- SQL Server 및 Oracle: 8KB  

대부분의 경우 데이터베이스의 기본 설정이 충분히 적합함.

---

## 4. 디스크가 페이지를 저장하는 방법

### 저장 구조
- 각 테이블 또는 컬렉션 단위로 파일을 생성하고, 고정 크기 페이지 배열로 구성함.  
- 파일 이름, 오프셋, 길이를 기반으로 디스크에서 페이지를 검색함.

### 예시
8KB 페이지 크기의 `test` 테이블에서 페이지 2부터 10까지 읽는 경우:  
- 파일 이름: `test` 테이블  
- 오프셋: 2 * 8192 = 16,384  
- 길이: (10 - 2) * 8192 = 65,536 바이트  

이 방식은 단순하면서도 효과적임.

---

## 5. PostgreSQL 페이지 레이아웃

### 기본 페이지 크기
PostgreSQL의 페이지 크기는 8KB이며, 페이지는 아래와 같이 구성됨.

### 페이지 레이아웃
1. **페이지 헤더 (24바이트)**  
   페이지 내 내용을 설명하는 메타데이터를 포함함.  

2. **아이템 ID (각각 4바이트)**  
   페이지 내 아이템(튜플)의 위치와 크기를 나타내는 포인터 배열이며, PostgreSQL의 HOT(Heap Only Tuple) 최적화를 가능하게 함.  

3. **아이템 (가변 길이)**  
   실제 데이터 저장 공간을 제공함.  

4. **특별 영역 (가변 길이)**  
   인덱스 리프 페이지에서 이전 및 다음 페이지에 대한 포인터 정보를 저장함.

---

## 결론
* 데이터베이스는 데이터를 페이지 단위로 저장하며, 이러한 구조는 데이터 읽기/쓰기 성능을 최적화함.  
* 페이지는 데이터를 효율적으로 관리할 수 있도록 설계되며, 데이터베이스마다 구현은 다르지만 기본 원칙은 동일함.
